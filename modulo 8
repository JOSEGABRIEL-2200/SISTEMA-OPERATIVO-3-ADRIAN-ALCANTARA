PRACTICA 1 - INSTALACION Y CONFIGURACION DE DOCKER


Instalar docker
sudo apt update && sudo apt install -y docker.io
sudo systemctl start docker
sudo systemctl enable docker

Verificar la instalación 
docker --version

Agregar mi usuario a docker (sin tener que reiniciar la maquina)
sudo usermod -aG docker gabriel
newgrp docker

Descargar la imagen de NGINX desde Docker Hub
docker pull nginx

Crear el directorio persistente 
mkdir -p /home/website 

Crear un contenedor con NGINX
docker run -d --name mi_nginx -p 8888:80 -v "/home/website:/usr/share/nginx/html" nginx

Verificar el contenedor
docker ps

Crear el archivo  index.html

sudo nano /home/website/index.html

<html>
<h1>nombre: JOSE GABRIEL FELIZ MARIA</h1>
    <p>Matrícula: 2025-0742</p>
</html>

Reiniciar el contenedor 
 
docker restart mi_pagina

Verificar la pagina en el navegador de mi host

entramos al localhost:8888

probamos el docker
detener
docker stop nombre

iniciamos nuevamente
docker start nombre

PRACTICA 2 - INSTALACION DE PORTAINER


Descarga la imagen de portainer desde Docker Hub

docker pull portainer/portainer-ce

Crear un contenedor con esa imagen
docker run -d --name portainer --restart always \
  -p 9443:9443 \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v portainer_data:/data \
  portainer/portainer-ce


docker restart portainer


Acceder a la interfaz
http://localhost:9443

Nos conectamos al local, en "live connect"
luego vamos a containers, buscamos mi_pagina
y le damos en stop,  verificamos que si se haya detenido en 

http://localhost:9443

PRACTICA 3 - CONTENEDOR DE WORDPRESS


Instalar docker y docker compose
sudo apt update && sudo apt install docker.io docker-compose -y

Crear la carpeta y dentro crear el archivo `docker-compose.yml`
mkdir wordpress_docker
cd wordpress_docker
nano docker-compose.yml

dentro del archivo 
version: '3.8'

services:
  db:
    image: mysql:latest
    container_name: wordpress_db
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wordpress_user
      MYSQL_PASSWORD: wordpress_password
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - wordpress_network

  wordpress:
    image: wordpress:latest
    container_name: wordpress_app
    restart: always
    depends_on:
      - db
    ports:
      - "8080:80"
    environment:
      WORDPRESS_DB_HOST: db:3306
      WORDPRESS_DB_USER: wordpress_user
      WORDPRESS_DB_PASSWORD: wordpress_password
      WORDPRESS_DB_NAME: wordpress
    volumes:
      - wordpress_data:/var/www/html
    networks:
      - wordpress_network

volumes:
  db_data:  # <-- Aquí declaras el volumen
  wordpress_data:

networks:
  wordpress_network:


Luego ejecutamos el despliegue con 
docker-compose up -d

Acceder al navegador 
http://localhost:8080
entrar a wordpress

verificar en el portainer el contenedor
http://localhost:9443





# PRACTICA: ALTA DISPONIBILIDAD CON KEEPALIVED + DOCKER

## OBJETIVO
Configurar dos servidores Linux que ejecutan Docker y Keepalived para ofrecer un servicio web altamente disponible mediante una IP virtual (VIP) que cambia automáticamente entre nodos si uno falla.

## REQUISITOS
- Dos servidores Linux (server1 y server2)
- Docker instalado en ambos nodos
- Keepalived instalado en ambos nodos
- Misma red para ambos nodos
- Una IP flotante / virtual (VIP) que será asignada al nodo activo

-------------------------------------

# PARTE 1: INSTALAR DOCKER EN AMBOS NODOS

## Paso 1: Actualizar repositorios
apt update
apt upgrade -y

## Paso 2: Instalar Docker
apt install docker.io -y

## Paso 3: Iniciar y habilitar Docker
systemctl start docker
systemctl enable docker

-------------------------------------

# PARTE 2: DESPLEGAR UN SERVICIO WEB CON DOCKER

## Paso 1: Crear contenedor web (server1)
docker run -d --name webserver -p 80:80 nginx

## Paso 2: Crear contenedor web (server2)
docker run -d --name webserver -p 80:80 nginx

-------------------------------------

# PARTE 3: INSTALAR KEEPALIVED

## Paso 1: Instalar Keepalived en ambos servidores
apt install keepalived -y

-------------------------------------

# PARTE 4: CONFIGURACIÓN DE KEEPALIVED

## Configuración en server1 (MASTER)

cat <<EOF > /etc/keepalived/keepalived.conf
vrrp_instance VI_1 {
    state MASTER
    interface eth0
    virtual_router_id 51
    priority 150
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 12345
    }
    virtual_ipaddress {
        192.168.1.200
    }
}
EOF

systemctl restart keepalived

## Configuración en server2 (BACKUP)

cat <<EOF > /etc/keepalived/keepalived.conf
vrrp_instance VI_1 {
    state BACKUP
    interface eth0
    virtual_router_id 51
    priority 100
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 12345
    }
    virtual_ipaddress {
        192.168.1.200
    }
}
EOF

systemctl restart keepalived

-------------------------------------

# PARTE 5: VALIDAR ALTA DISPONIBILIDAD

## Paso 1: Revisar si el MASTER tomó la IP virtual
ip addr show

Debe verse 192.168.1.200 asignada al MASTER.

## Paso 2: Acceder al servicio web por VIP
curl http://192.168.1.200

## Paso 3: Simular caída del nodo MASTER
systemctl stop keepalived

## Paso 4: Verificar que el BACKUP tomó la IP
ip addr show

## Paso 5: Acceder otra vez al servicio web por VIP
curl http://192.168.1.200

El servicio debe seguir respondiendo.

-------------------------------------

# NOTAS, ERRORES Y SOLUCIONES

- Error: La IP virtual no aparece  
  Causa: Nombre de interfaz incorrecto  
  Solución: Ejecutar ip a y reemplazar eth0 por la interfaz correcta  

- Error: Ambos nodos toman la IP  
  Causa: Mismo valor de priority  
  Solución: Prioridad mayor para MASTER  

- Error: El servicio no responde por la VIP  
  Causa: El contenedor Docker no está en ejecución  
  Solución: docker ps  
            systemctl restart keepalived  

- Error: FAILOVER no funciona  
  Causa: keepalived no reinició correctamente  
  Solución: systemctl status keepalived  
            Verificar archivo keepalived.conf  

- Error: nginx no inicia  
  Causa: Puerto 80 en uso  
  Solución: lsof -i:80  
            Matar proceso o cambiar puerto  

-------------------------------------

# TÉRMINOS IMPORTANTES

- **VRRP**: Protocolo que permite que múltiples servidores compartan una misma IP virtual.
- **VIP**: IP virtual flotante que migra entre nodos al producirse fallos.
- **Keepalived**: Servicio que gestiona VRRP y salud del sistema para alta disponibilidad.
- **Docker**: Plataforma para ejecutar aplicaciones aisladas en contenedores.
- **MASTER**: Nodo principal que posee la IP virtual.
- **BACKUP**: Nodo en espera que toma la IP si el MASTER falla.
- **Failover**: Proceso de transferir servicios de un nodo fallado a otro operativo.






